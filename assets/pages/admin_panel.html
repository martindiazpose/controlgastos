<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="icon" href="../img/carpeta.png" type="image/x-icon">

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
            color: #343a40;
        }
        .section {
            margin: 20px 0;
        }
        .input-group {
            margin: 20px auto;
            max-width: 600px;
        }
        .list-group {
            max-width: 600px;
            margin: 20px auto;
        }
        .list-group-item {
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }
        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            color: #343a40;
        }
        .modal-header, .modal-footer {
            border: none;
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .modal-body {
            font-size: 1.2rem;
            padding: 20px;
        }
        .btn-close {
            background-color: #dc3545;
            border: none;
            color: #fff;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .btn-close:hover {
            background-color: #c82333;
        }
        .btn-secondary, .btn-secondary:focus, .btn-secondary:hover {
            background-color: #6c757d;
            border-color: #6c757d;
        }
    </style>
</head>
<body class="container">
    <h1>Panel Administrativo</h1>

    <div class="section">
        <h2>Gestión de Pacientes</h2>
        <div class="input-group mb-3">
            <input type="text" id="patient-name" class="form-control" placeholder="Nombre del paciente">
            <select id="patient-type" class="form-control">
                <option disabled selected>Seleccionar...</option>
                <option value="mensual">Mensual</option>
                <option value="semanal">Semanal</option>
            </select>
            <div class="input-group-append">
                <button id="add-patient" class="btn btn-primary">Agregar Paciente</button>
            </div>
        </div>
        <div class="filter-group mb-3">
            <select id="filter-type" class="form-control">
                <option value="all">Todos</option>
                <option value="mensual">Mensuales</option>
                <option value="semanal">Semanales</option>
            </select>
        </div>
        <ul id="patient-list" class="list-group"></ul>
    </div>

    <div class="section">
        <h2>Gestión de Categorías</h2>
        <div class="input-group mb-3">
            <input type="text" id="category-name" class="form-control" placeholder="Nombre de la categoría">
            <select id="category-type" class="form-control">
                <option disabled selected>Seleccionar...</option>
                <option value="ingreso">Ingreso</option>
                <option value="egreso">Egreso</option>
            </select>
            <div class="input-group-append">
                <button id="add-category" class="btn btn-primary">Agregar Categoría</button>
            </div>
        </div>
        <div class="filter-group mb-3">
            <select id="filter-category-type" class="form-control">
                <option value="all">Todas</option>
                <option value="ingreso">Ingresos</option>
                <option value="egreso">Egresos</option>
            </select>
        </div>
        <ul id="category-list" class="list-group"></ul>
    </div>

    <!-- Modal de confirmación y mensajes -->
    <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="messageModalLabel">Mensaje</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalMessage">
                    <!-- Mensaje se mostrará aquí -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación de eliminación -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmación de Eliminación</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Mensaje de confirmación se mostrará aquí -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteButton">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
$(document).ready(function() {
    loadPatients();
    loadCategories();

    $('#add-patient').click(function() {
        let name = $('#patient-name').val().trim();
        let type = $('#patient-type').val();

        // Asegúrate de que el nombre y el tipo no están vacíos
        if (name && (type === 'mensual' || type === 'semanal')) {
            $.post('https://controlgastos.wantedstudio.uy/php/manage_patients.php', { action: 'add', name: name, type: type }, function(response) {
                if (response.status === 'success') {
                    $('#modalMessage').text(`Paciente ${name} agregado correctamente a la lista de ${type}.`);
                } else {
                    $('#modalMessage').text(`Error al agregar paciente: ${response.error}`);
                }
                $('#messageModal').modal('show');
                loadPatients();
                $('#patient-name').val('');
                $('#patient-type').val('');
            }, 'json').fail(function() {
                $('#modalMessage').text('Error al agregar paciente. Intente más tarde.');
                $('#messageModal').modal('show');
            });
        } else {
            $('#modalMessage').text('Por favor, completa todos los campos correctamente.');
            $('#messageModal').modal('show');
        }
    });

    $('#add-category').click(function() {
        let name = $('#category-name').val().trim();
        let type = $('#category-type').val();

        // Asegúrate de que el nombre y el tipo no están vacíos
        if (name && (type === 'ingreso' || type === 'egreso')) {
            $.post('https://controlgastos.wantedstudio.uy/php/manage_categories.php', { action: 'add', name: name, type: type }, function(response) {
                if (response.status === 'success') {
                    $('#modalMessage').text(`Categoría ${name} agregada correctamente.`);
                } else {
                    $('#modalMessage').text(`Error al agregar categoría: ${response.error}`);
                }
                $('#messageModal').modal('show');
                loadCategories();
                $('#category-name').val('');
                $('#category-type').val('');
            }, 'json').fail(function() {
                $('#modalMessage').text('Error al agregar categoría. Intente más tarde.');
                $('#messageModal').modal('show');
            });
        } else {
            $('#modalMessage').text('Por favor, completa todos los campos correctamente.');
            $('#messageModal').modal('show');
        }
    });

    $('#filter-type').change(function() {
        loadPatients();
    });

    $('#filter-category-type').change(function() {
        loadCategories();
    });

    $(document).on('click', '.delete-patient', function() {
        let id = $(this).data('id');
        let name = $(this).data('name');
        let type = $(this).data('type');
        $('#confirmDeleteModal .modal-body').text(`¿Está seguro que desea eliminar al paciente ${name} de la lista de pacientes ${type}?`);
        $('#confirmDeleteButton').data('id', id);
        $('#confirmDeleteButton').data('name', name);
        $('#confirmDeleteButton').data('type', type);
        $('#confirmDeleteModal').modal('show');
    });

    $('#confirmDeleteButton').click(function() {
        let id = $(this).data('id');
        let name = $(this).data('name');
        let type = $(this).data('type');
        $.post('https://controlgastos.wantedstudio.uy/php/manage_patients.php', { action: 'delete', id: id }, function(response) {
            if (response.status === 'success') {
                $('#modalMessage').text(`Paciente ${name} eliminado correctamente de la lista de ${type}.`);
            } else {
                $('#modalMessage').text(`Error al eliminar paciente: ${response.error}`);
            }
            $('#messageModal').modal('show');
            loadPatients();
        }, 'json').fail(function() {
            $('#modalMessage').text('Error al eliminar paciente. Intente más tarde.');
            $('#messageModal').modal('show');
        });
        $('#confirmDeleteModal').modal('hide');
    });

    $(document).on('click', '.delete-category', function() {
        let id = $(this).data('id');
        let name = $(this).data('name');
        $.post('../php/manage_categories.php', { action: 'delete', id: id }, function(response) {
            if (response.status === 'success') {
                $('#modalMessage').text(`Categoría ${name} eliminada correctamente.`);
            } else {
                $('#modalMessage').text(`Error al eliminar categoría: ${response.error}`);
            }
            $('#messageModal').modal('show');
            loadCategories();
        }, 'json').fail(function() {
            $('#modalMessage').text('Error al eliminar categoría. Intente más tarde.');
            $('#messageModal').modal('show');
        });
    });

    function loadPatients() {
        let filterType = $('#filter-type').val();
        $.get('https://controlgastos.wantedstudio.uy/php/manage_patients.php', { action: 'list', type: filterType }, function(response) {
            let patientList = $('#patient-list');
            patientList.empty();
            if (Array.isArray(response)) {
                response.forEach(function(patient) {
                    patientList.append(`<li class="list-group-item d-flex justify-content-between align-items-center">
                        ${patient.nombre} (${patient.tipo})
                        <button class="btn btn-danger btn-sm delete-patient" data-id="${patient.id}" data-name="${patient.nombre}" data-type="${patient.tipo}">Eliminar</button>
                    </li>`);
                });
            } else {
                $('#modalMessage').text(`Error al cargar lista de pacientes: ${response.error}`);
                $('#messageModal').modal('show');
            }
        }, 'json').fail(function() {
            $('#modalMessage').text('Error al cargar lista de pacientes. Intente más tarde.');
            $('#messageModal').modal('show');
        });
    }

    function loadCategories() {
        let filterType = $('#filter-category-type').val();
        $.get('https://controlgastos.wantedstudio.uy/php/manage_categories.php', { action: 'list', type: filterType }, function(response) {
            let categoryList = $('#category-list');
            categoryList.empty();
            if (Array.isArray(response)) {
                response.forEach(function(category) {
                    categoryList.append(`<li class="list-group-item d-flex justify-content-between align-items-center">
                        ${category.nombre} (${category.tipo})
                        <button class="btn btn-danger btn-sm delete-category" data-id="${category.id}" data-name="${category.nombre}" data-type="${category.tipo}">Eliminar</button>
                    </li>`);
                });
            } else {
                $('#modalMessage').text(`Error al cargar lista de categorías: ${response.error}`);
                $('#messageModal').modal('show');
            }
        }, 'json').fail(function() {
            $('#modalMessage').text('Error al cargar lista de categorías. Intente más tarde.');
            $('#messageModal').modal('show');
        });
    }
});
    </script>
</body>
</html>